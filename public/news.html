<script>
(async function(){
  const res = await fetch('/news.json', {cache:'no-store'});
  const data = await res.json();
  const list = document.getElementById('newsList');
  const q = document.getElementById('q');
  const cat = document.getElementById('cat');

  let items = data.items;

  function render(rows){
    list.innerHTML = rows.map(x => `
      <li>
        <a href="${x.link}">
          <strong>${x.title}</strong>
        </a>
        <div>${x.date} Â· ${x.categories.join(', ')}</div>
        <p>${x.summary || ''}</p>
      </li>`).join('');
  }

  function apply(){
    const kw = (q.value||'').toLowerCase();
    const c = cat.value;
    let rows = items.filter(x =>
      (!c || x.categories.includes(c)) &&
      (x.title.toLowerCase().includes(kw) || (x.summary||'').toLowerCase().includes(kw))
    );
    render(rows);
  }

  q.addEventListener('input', apply);
  cat.addEventListener('change', apply);
  render(items);
})();
</script>
