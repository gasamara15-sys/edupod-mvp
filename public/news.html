<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>뉴스 목록 | EduPod</title>
  <link rel="canonical" href="https://www.edupod.kr/news.html" />
  <meta name="description" content="날짜/주제/제목으로 검색 가능한 뉴스 목록" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;margin:0;background:#fafafa;color:#111827}
    header{padding:16px 20px;background:#fff;border-bottom:1px solid #e5e7eb}
    main{max-width:920px;margin:0 auto;padding:20px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    input,select{border:1px solid #e5e7eb;border-radius:10px;padding:8px 10px;background:#fff}
    ul{list-style:none;margin:0;padding:0;display:grid;gap:12px}
    li{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px}
    li a{color:#111827;text-decoration:none}
    li a:hover{text-decoration:underline}
    .meta{font-size:12px;color:#6b7280;margin-top:4px}
    p{margin:8px 0 0;color:#374151}
    .empty{color:#6b7280;padding:24px;text-align:center;border:1px dashed #e5e7eb;border-radius:12px;background:#fff}
  </style>
</head>
<body>
  <header>
    <strong>EduPod</strong> — 뉴스 목록
  </header>

  <main>
    <!-- 검색/필터 -->
    <div class="toolbar">
      <input id="q" type="search" placeholder="제목·요약 검색" />
      <select id="cat">
        <option value="">전체 카테고리</option>
        <!-- JS가 카테고리를 채워 넣습니다 -->
      </select>
    </div>

    <!-- 리스트 -->
    <ul id="newsList">
      <!-- JS가 아이템을 렌더링합니다 -->
    </ul>
  </main>

  <script>
  (async function () {
    // 1) news.json 로드
    const res = await fetch('/news.json', { cache: 'no-store' });
    if (!res.ok) {
      document.getElementById('newsList').innerHTML =
        '<li class="empty">news.json을 불러오지 못했습니다.</li>';
      return;
    }
    const data = await res.json();

    const list = document.getElementById('newsList');
    const q = document.getElementById('q');
    const cat = document.getElementById('cat');

    let items = Array.isArray(data.items) ? data.items : [];
    // 날짜 최신순 보장
    items.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

    // id / 파일명 기반 맵 (id=latest, id=파일명 지원)
    const byId = new Map(items.map(x => [String(x.id || ''), x]));
    function basenameId(link = '') {
      try {
        const p = new URL(link, location.origin).pathname;
        const base = (p.split('/').pop() || '').replace(/\.html?$/i, '');
        return base;
      } catch { return ''; }
    }
    const byFileId = new Map(items.map(x => [basenameId(x.link), x]));

    // 2) URL 파라미터 처리 (?id=latest | ?id=some-id)
    const params = new URLSearchParams(location.search);
    const idParam = params.get('id');
    if (idParam) {
      if (idParam === 'latest') {
        const first = items[0];
        if (first?.link) { location.href = first.link; return; }
      } else {
        const target = byId.get(idParam) || byFileId.get(idParam);
        if (target?.link) { location.href = target.link; return; }
      }
      // 못 찾으면 목록 렌더링 계속
    }

    // 3) 카테고리 옵션 채우기
    const cats = new Set();
    items.forEach(x => (x.categories || []).forEach(c => cats.add(c)));
    [...cats].sort().forEach(cn => {
      const opt = document.createElement('option');
      opt.value = cn; opt.textContent = cn;
      cat.appendChild(opt);
    });

    // 4) 렌더/필터
    function render(rows) {
      if (!rows.length) {
        list.innerHTML = '<li class="empty">검색 결과가 없습니다.</li>';
        return;
      }
      list.innerHTML = rows.map(x => `
        <li>
          <a href="${x.link}"><strong>${x.title}</strong></a>
          <div class="meta">${x.date || ''} · ${(x.categories || []).join(', ')}</div>
          <p>${x.summary || ''}</p>
        </li>
      `).join('');
    }

    function apply() {
      const kw = (q.value || '').toLowerCase();
      const c = cat.value;
      const rows = items.filter(x => {
        const inCat = !c || (x.categories || []).includes(c);
        const hay = ((x.title || '') + ' ' + (x.summary || '')).toLowerCase();
        return inCat && hay.includes(kw);
      });
      render(rows);
    }

    q.addEventListener('input', apply);
    cat.addEventListener('change', apply);

    // 초기 렌더
    render(items);
  })();
  </script>
</body>
</html>
