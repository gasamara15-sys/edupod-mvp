<script>
  const list = document.getElementById("list");
  const q = document.getElementById("q");
  let data = [];

  // 현재 페이지(/vocab/) 기준으로 안전한 상대경로 생성 + 캐시 버스팅
  const jsonUrl = new URL("./frequency/top100.json", window.location.href);
  jsonUrl.searchParams.set("v", Date.now());

  function render(arr){
    if (!arr.length) {
      list.innerHTML = `<p style="color:#666">표시할 항목이 없습니다.</p>`;
      return;
    }
    list.innerHTML = arr.map(x => `
      <div class="card">
        <div class="rank">${x.rank}. ${x.word} <span class="muted">(${x.partOfSpeech||""})</span></div>
        <div>${x.meaning || ""}</div>
        <div class="muted">${x.example_en || ""}</div>
        <div>${x.example_ko || ""}</div>
      </div>
    `).join("");
  }

  // 오류를 화면에 보여주기
  function showError(msg) {
    list.innerHTML = `<p style="color:#c00">로드 오류: ${msg}</p>`;
  }

  // JSON 로드
  fetch(jsonUrl, { cache: "no-store" })
    .then(r => {
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.json();
    })
    .then(json => { data = json; render(json); })
    .catch(err => {
      console.error("fetch error", err);
      showError(err.message);
    });

  // 검색
  q.addEventListener("input", () => {
    const v = q.value.trim().toLowerCase();
    const filtered = !v ? data : data.filter(
      x =>
        (x.word||"").toLowerCase().includes(v) ||
        (x.meaning||"").toLowerCase().includes(v) ||
        (x.example_en||"").toLowerCase().includes(v)
    );
    render(filtered);
  });
</script>
