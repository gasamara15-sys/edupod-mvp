<script>
document.addEventListener("DOMContentLoaded", () => {
  const list = document.getElementById("list");
  const q = document.getElementById("q");
  let data = [];

  // 1) base path 보정: /vocab (파일처럼 보이는 경로)이면 /vocab/ 로 만들어줌
  const basePath = location.pathname.endsWith("/")
    ? location.pathname
    : location.pathname + "/";

  // 2) JSON 절대경로 생성 (캐시 버스팅 포함)
  //    현재 페이지가 /vocab 또는 /vocab/ 인 상황 모두 대응 → /vocab/frequency/top100.json
  const jsonUrl = new URL(basePath + "frequency/top100.json", location.origin);
  jsonUrl.searchParams.set("v", Date.now());

  function render(arr){
    if (!arr.length) {
      list.innerHTML = `<p style="color:#666">표시할 항목이 없습니다.</p>`;
      return;
    }
    list.innerHTML = arr.map(x => `
      <div class="card">
        <div class="rank">${x.rank}. ${x.word} <span class="muted">(${x.partOfSpeech||""})</span></div>
        <div>${x.meaning || ""}</div>
        <div class="muted">${x.example_en || ""}</div>
        <div>${x.example_ko || ""}</div>
      </div>
    `).join("");
  }

  function showError(msg) {
    list.innerHTML = `<p style="color:#c00">로드 오류: ${msg}</p>`;
  }

  fetch(jsonUrl.toString(), { cache: "no-store" })
    .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.json(); })
    .then(json => { data = json; render(json); })
    .catch(err => { console.error("fetch error", err); showError(err.message); });

  q.addEventListener("input", () => {
    const v = q.value.trim().toLowerCase();
    const filtered = !v ? data : data.filter(
      x =>
        (x.word||"").toLowerCase().includes(v) ||
        (x.meaning||"").toLowerCase().includes(v) ||
        (x.example_en||"").toLowerCase().includes(v)
    );
    render(filtered);
  });
});
</script>
